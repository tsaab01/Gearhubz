<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KXB4P8MJ');</script>
    <!-- End Google Tag Manager -->
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Free Online Image Compressor - Reduce Image Size Without Losing Quality | ToolsHub</title>
    <meta name="description" content="Compress images online for free! Reduce file size without losing quality. Perfect for websites, emails, and social media. No signup required.">
    <meta name="keywords" content="image compressor, compress image online, reduce image size, image optimization, free image compressor, online image tool">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Free Online Image Compressor - ToolsHub">
    <meta property="og:description" content="Compress your images online without losing quality. Reduce file size for faster loading and better performance.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourdomain.com/image-compressor">
    <meta property="og:site_name" content="ToolsHub">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Free Online Image Compressor">
    <meta name="twitter:description" content="Compress images online for free! Reduce file size without losing quality.">
    
    <!-- Canonical and other meta tags -->
    <link rel="canonical" href="https://yourdomain.com/image-compressor">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-blue: #4F46E5;
            --hover-blue: #4338CA;
            --bg-blue-tint: #EEF2FF;
            --white: #FFFFFF;
            --card-bg: #F9FAFB;
            --border: #E5E7EB;
            --text-primary: #1F2937;
            --text-secondary: #4B5563;
            --text-muted: #9CA3AF;
            --purple-gradient: linear-gradient(90deg, #6366F1, #8B5CF6);
        }

        body {
            background-color: var(--bg-blue-tint);
            color: var(--text-primary);
            padding: 20px;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: var(--purple-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .tool-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }

        .upload-section, .preview-section {
            flex: 1;
            min-width: 300px;
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary-blue);
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--card-bg);
        }

        .upload-area:hover {
            border-color: var(--primary-blue);
            background-color: rgba(79, 70, 229, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .browse-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .browse-btn:hover {
            background: var(--hover-blue);
        }

        #file-input {
            display: none;
        }

        .file-info {
            margin-top: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .file-size {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .compression-controls {
            margin-top: 25px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: var(--border);
            border-radius: 4px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
        }

        .value-display {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: var(--primary-blue);
        }

        .compress-btn {
            width: 100%;
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 10px;
        }

        .compress-btn:hover {
            background: var(--hover-blue);
        }

        .compress-btn:disabled {
            background: var(--border);
            cursor: not-allowed;
        }

        .preview-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .image-preview {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            min-height: 300px;
            margin-bottom: 20px;
            position: relative;
        }

        .preview-placeholder {
            text-align: center;
            color: var(--text-muted);
        }

        .preview-placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--border);
        }

        .preview-image {
            max-width: 100%;
            max-height: 100%;
            display: none;
            object-fit: contain;
        }

        .download-section {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            display: none;
        }

        .download-section.active {
            display: block;
        }

        .download-info {
            margin-bottom: 20px;
        }

        .size-reduction {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 1.2rem;
        }

        .download-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .download-btn:hover {
            background: var(--hover-blue);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            background: var(--white);
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        /* SEO Content Section */
        .seo-content {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            margin: 40px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .seo-content h2 {
            font-size: 1.8rem;
            margin: 25px 0 15px 0;
            color: var(--text-primary);
        }

        .seo-content h3 {
            font-size: 1.4rem;
            margin: 20px 0 10px 0;
            color: var(--text-primary);
        }

        .seo-content p {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .seo-content ul, .seo-content ol {
            margin: 15px 0 15px 30px;
            color: var(--text-secondary);
        }

        .seo-content li {
            margin-bottom: 10px;
        }

        .benefits-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .benefit-item {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
        }

        .benefit-item h4 {
            color: var(--primary-blue);
            margin-bottom: 10px;
        }

        /* Toggle Styles */
        .toggle-container {
            margin: 15px 0;
        }

        .toggle-header {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            transition: background 0.3s;
        }

        .toggle-header:hover {
            background: #e5e7eb;
        }

        .toggle-header h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .toggle-icon {
            transition: transform 0.3s;
        }

        .toggle-content {
            padding: 15px;
            background: var(--white);
            border-left: 3px solid var(--primary-blue);
            display: none;
        }

        .toggle-content.active {
            display: block;
        }

        .related-tools {
            margin-top: 30px;
            text-align: center;
        }

        .tools-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .tool-link {
            display: inline-block;
            background: var(--primary-blue);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            transition: background 0.3s;
        }

        .tool-link:hover {
            background: var(--hover-blue);
        }

        @media (max-width: 768px) {
            .tool-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .benefits-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Image Compressor",
      "description": "Free online tool to compress images without losing quality",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "reviewCount": "1420"
      }
    }
    </script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KXB4P8MJ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="container">
        <header>
            <h1>Free Online Image Compressor</h1>
            <p class="subtitle">Compress your images without losing quality. Reduce file size for faster loading and better performance.</p>
        </header>

        <div class="tool-container">
            <div class="upload-section">
                <h2 class="section-title"><i class="fas fa-cloud-upload-alt"></i> Upload Image</h2>
                
                <div class="upload-area" id="drop-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-image"></i>
                    </div>
                    <p class="upload-text">Drag & drop your image here</p>
                    <p class="upload-text">or</p>
                    <button class="browse-btn">Browse Files</button>
                    <input type="file" id="file-input" accept="image/*">
                </div>
                
                <div class="file-info" id="file-info">
                    <div class="file-name" id="file-name">image.jpg</div>
                    <div class="file-size" id="file-size">2.4 MB</div>
                </div>
                
                <div class="compression-controls">
                    <div class="control-group">
                        <div class="control-label">
                            <span>Compression Quality</span>
                            <span class="value-display" id="quality-value">80%</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" min="10" max="100" value="80" class="slider" id="quality-slider">
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <div class="control-label">
                            <span>Image Size</span>
                            <span class="value-display" id="size-value">100%</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" min="10" max="100" value="100" class="slider" id="size-slider">
                        </div>
                    </div>
                    
                    <button class="compress-btn" id="compress-btn" disabled>Compress Image</button>
                </div>
            </div>
            
            <div class="preview-section">
                <h2 class="section-title"><i class="fas fa-eye"></i> Preview</h2>
                
                <div class="preview-container">
                    <div class="image-preview">
                        <div class="preview-placeholder" id="preview-placeholder">
                            <i class="fas fa-image"></i>
                            <p>Your compressed image will appear here</p>
                        </div>
                        <img class="preview-image" id="preview-image" alt="Preview">
                    </div>
                    
                    <div class="download-section" id="download-section">
                        <div class="download-info">
                            <p>Compression completed successfully!</p>
                            <p class="size-reduction">File size reduced by <span id="reduction-percent">45%</span></p>
                        </div>
                        <button class="download-btn" id="download-btn">
                            <i class="fas fa-download"></i> Download Compressed Image
                        </button>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="original-size">0 KB</div>
                            <div class="stat-label">Original Size</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="compressed-size">0 KB</div>
                            <div class="stat-label">Compressed Size</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="saved-space">0 KB</div>
                            <div class="stat-label">Space Saved</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- SEO Content Section -->
        <section class="seo-content">
            <article>
                <h2>What is an Online Image Compressor?</h2>
                <p>An online image compressor is a free web-based tool that reduces the file size of your digital images without significantly compromising quality. It's perfect for optimizing images for websites, emails, social media, and other digital platforms where file size matters.</p>
                
                <h2>Why Use Our Free Image Compressor?</h2>
                <div class="benefits-list">
                    <div class="benefit-item">
                        <h4><i class="fas fa-bolt"></i> Lightning Fast</h4>
                        <p>Compress images in seconds with our optimized processing engine.</p>
                    </div>
                    <div class="benefit-item">
                        <h4><i class="fas fa-lock"></i> Privacy First</h4>
                        <p>Your images are processed locally and never stored on our servers.</p>
                    </div>
                    <div class="benefit-item">
                        <h4><i class="fas fa-mobile-alt"></i> Works Everywhere</h4>
                        <p>Use on any device - desktop, tablet, or mobile phone.</p>
                    </div>
                    <div class="benefit-item">
                        <h4><i class="fas fa-infinity"></i> Unlimited Usage</h4>
                        <p>Compress as many images as you want - completely free.</p>
                    </div>
                </div>
                
                <h2>Common Use Cases</h2>
                <div class="toggle-container">
                    <div class="toggle-header" onclick="toggleContent('use1')">
                        <h4>Website Optimization</h4>
                        <i class="fas fa-chevron-down toggle-icon" id="icon-use1"></i>
                    </div>
                    <div class="toggle-content" id="content-use1">
                        <p>Reduce image file sizes to improve page loading speed and user experience. Faster websites rank better in search engines and provide better user engagement. Optimized images also reduce bandwidth costs for website owners.</p>
                    </div>
                </div>
                
                <div class="toggle-container">
                    <div class="toggle-header" onclick="toggleContent('use2')">
                        <h4>Social Media Sharing</h4>
                        <i class="fas fa-chevron-down toggle-icon" id="icon-use2"></i>
                    </div>
                    <div class="toggle-content" id="content-use2">
                        <p>Compress large photos before uploading to Facebook, Instagram, Twitter, and other platforms to avoid long upload times and platform restrictions. Smaller files upload faster and consume less data.</p>
                    </div>
                </div>
                
                <div class="toggle-container">
                    <div class="toggle-header" onclick="toggleContent('use3')">
                        <h4>Email Attachments</h4>
                        <i class="fas fa-chevron-down toggle-icon" id="icon-use3"></i>
                    </div>
                    <div class="toggle-content" id="content-use3">
                        <p>Reduce image sizes to stay within email attachment limits and ensure faster delivery of your messages. Compressed images also help reduce email storage space requirements.</p>
                    </div>
                </div>
                
                <h2>How to Use the Image Compressor</h2>
                <ol>
                    <li><strong>Upload</strong> - Click "Browse Files" or drag and drop your image onto the upload area</li>
                    <li><strong>Adjust Settings</strong> - Use the sliders to control compression quality and image size</li>
                    <li><strong>Compress</strong> - Click "Compress Image" to process your file</li>
                    <li><strong>Download</strong> - Click "Download Compressed Image" to save your optimized file</li>
                </ol>
                
                <div class="faq-section">
                    <h2>Frequently Asked Questions</h2>
                    <div class="toggle-container">
                        <div class="toggle-header" onclick="toggleContent('faq1')">
                            <h4>Is this image compressor really free?</h4>
                            <i class="fas fa-chevron-down toggle-icon" id="icon-faq1"></i>
                        </div>
                        <div class="toggle-content" id="content-faq1">
                            <p>Yes, our image compressor is completely free to use with no limitations, registrations, or watermarks. Compress as many images as you need at no cost. We believe in providing valuable tools without hidden fees or premium restrictions.</p>
                        </div>
                    </div>
                    
                    <div class="toggle-container">
                        <div class="toggle-header" onclick="toggleContent('faq2')">
                            <h4>What file formats are supported?</h4>
                            <i class="fas fa-chevron-down toggle-icon" id="icon-faq2"></i>
                        </div>
                        <div class="toggle-content" id="content-faq2">
                            <p>We support all major image formats including JPG, JPEG, PNG, GIF, and WebP. The compressed output will be in JPG format for optimal compatibility. Our system automatically converts your images to the most efficient format for web use.</p>
                        </div>
                    </div>
                    
                    <div class="toggle-container">
                        <div class="toggle-header" onclick="toggleContent('faq3')">
                            <h4>How much can I reduce my image size?</h4>
                            <i class="fas fa-chevron-down toggle-icon" id="icon-faq3"></i>
                        </div>
                        <div class="toggle-content" id="content-faq3">
                            <p>Depending on your original image and settings, you can typically reduce file sizes by 50-90% while maintaining good visual quality. Our intelligent compression preserves important image details while removing unnecessary data. The exact reduction depends on the original file format and content.</p>
                        </div>
                    </div>
                    
                    <div class="toggle-container">
                        <div class="toggle-header" onclick="toggleContent('faq4')">
                            <h4>Is my privacy protected?</h4>
                            <i class="fas fa-chevron-down toggle-icon" id="icon-faq4"></i>
                        </div>
                        <div class="toggle-content" id="content-faq4">
                            <p>Absolutely. Your images are processed directly in your browser and never uploaded to our servers. We don't store or access your files in any way. Once you close the browser tab, all processed data is automatically deleted from your device's memory.</p>
                        </div>
                    </div>
                </div>
                
                <div class="related-tools">
                    <h3>Related Free Tools</h3>
                    <div class="tools-grid">
                        <a href="/image-resizer" class="tool-link">Image Resizer</a>
                        <a href="/image-converter" class="tool-link">Image Converter</a>
                        <a href="/pdf-compressor" class="tool-link">PDF Compressor</a>
                        <a href="/file-converter" class="tool-link">File Converter</a>
                    </div>
                </div>
            </article>
        </section>
        
        <footer>
            <p>© 2023 Tools Hub - Your Daily Tools, All At One Place</p>
        </footer>
    </div>
    
    <!-- Adsterra Ad Code -->
    <script async="async" data-cfasync="false" src="//pl28047254.effectivegatecpm.com/a066ce0b5c2ab4f8b4fedb09d93370eb/invoke.js"></script>
    <div id="container-a066ce0b5c2ab4f8b4fedb09d93370eb"></div>
    <!-- End Adsterra Ad Code -->

    <script>
        // Toggle functionality
        function toggleContent(id) {
            const content = document.getElementById('content-' + id);
            const icon = document.getElementById('icon-' + id);
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('active');
                icon.style.transform = 'rotate(180deg)';
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const browseBtn = document.querySelector('.browse-btn');
            const fileInfo = document.getElementById('file-info');
            const fileName = document.getElementById('file-name');
            const fileSize = document.getElementById('file-size');
            const qualitySlider = document.getElementById('quality-slider');
            const qualityValue = document.getElementById('quality-value');
            const sizeSlider = document.getElementById('size-slider');
            const sizeValue = document.getElementById('size-value');
            const compressBtn = document.getElementById('compress-btn');
            const previewPlaceholder = document.getElementById('preview-placeholder');
            const previewImage = document.getElementById('preview-image');
            const downloadSection = document.getElementById('download-section');
            const downloadBtn = document.getElementById('download-btn');
            const reductionPercent = document.getElementById('reduction-percent');
            const originalSizeEl = document.getElementById('original-size');
            const compressedSizeEl = document.getElementById('compressed-size');
            const savedSpaceEl = document.getElementById('saved-space');
            
            // State variables
            let originalFile = null;
            let originalSize = 0;
            let compressedBlob = null;
            
            // Event Listeners
            browseBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.style.borderColor = '#4F46E5';
                dropArea.style.backgroundColor = 'rgba(79, 70, 229, 0.1)';
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.style.borderColor = '#E5E7EB';
                dropArea.style.backgroundColor = '#F9FAFB';
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.style.borderColor = '#E5E7EB';
                dropArea.style.backgroundColor = '#F9FAFB';
                
                if (e.dataTransfer.files.length) {
                    handleFiles(e.dataTransfer.files);
                }
            });
            
            qualitySlider.addEventListener('input', () => {
                qualityValue.textContent = `${qualitySlider.value}%`;
            });
            
            sizeSlider.addEventListener('input', () => {
                sizeValue.textContent = `${sizeSlider.value}%`;
            });
            
            compressBtn.addEventListener('click', compressImage);
            downloadBtn.addEventListener('click', downloadCompressedImage);
            
            // Functions
            function handleFileSelect(e) {
                if (e.target.files.length) {
                    handleFiles(e.target.files);
                }
            }
            
            function handleFiles(files) {
                const file = files[0];
                if (!file.type.match('image.*')) {
                    alert('Please select an image file (JPEG, PNG, etc.)');
                    return;
                }
                
                originalFile = file;
                originalSize = file.size;
                updateFileInfo(file);
                displayImagePreview(file);
                compressBtn.disabled = false;
            }
            
            function updateFileInfo(file) {
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                fileInfo.classList.add('active');
                originalSizeEl.textContent = formatFileSize(file.size);
            }
            
            function displayImagePreview(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                    previewPlaceholder.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
            
            function compressImage() {
                if (!originalFile) {
                    alert('Please upload an image first');
                    return;
                }
                
                const quality = qualitySlider.value / 100;
                const sizeFactor = sizeSlider.value / 100;
                
                // Create canvas for compression
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                const img = new Image();
                img.onload = function() {
                    // Calculate new dimensions
                    const newWidth = Math.max(10, img.width * sizeFactor);
                    const newHeight = Math.max(10, img.height * sizeFactor);
                    
                    canvas.width = newWidth;
                    canvas.height = newHeight;
                    
                    // Fill with white background for JPEG
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, newWidth, newHeight);
                    
                    // Draw resized image
                    ctx.drawImage(img, 0, 0, newWidth, newHeight);
                    
                    // Convert to blob with compression
                    canvas.toBlob(function(blob) {
                        if (blob) {
                            compressedBlob = blob;
                            
                            // Calculate compression results
                            const compressedSize = blob.size;
                            const reduction = Math.round((1 - compressedSize / originalSize) * 100);
                            
                            // Update UI with results
                            reductionPercent.textContent = `${reduction}%`;
                            compressedSizeEl.textContent = formatFileSize(compressedSize);
                            savedSpaceEl.textContent = formatFileSize(originalSize - compressedSize);
                            
                            // Show download section
                            downloadSection.classList.add('active');
                            
                            // Update preview with compressed version
                            const compressedUrl = URL.createObjectURL(blob);
                            previewImage.src = compressedUrl;
                            
                            // Track compression event
                            if (typeof dataLayer !== 'undefined') {
                                dataLayer.push({
                                    'event': 'tool_compress',
                                    'toolName': 'Image Compressor',
                                    'compressionQuality': qualitySlider.value,
                                    'sizeFactor': sizeSlider.value
                                });
                            }
                        } else {
                            alert('Compression failed. Please try a different image.');
                        }
                    }, 'image/jpeg', quality);
                };
                
                // Load original image
                const reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(originalFile);
            }
            
            // FIXED DOWNLOAD FUNCTION WITH REAL FUNCTIONALITY
            function downloadCompressedImage() {
                if (!compressedBlob) {
                    alert('Please compress an image first');
                    return;
                }
                
                // Create filename
                const originalName = originalFile.name;
                const nameWithoutExt = originalName.substring(0, originalName.lastIndexOf('.')) || originalName;
                const filename = `${nameWithoutExt}_compressed.jpg`;
                
                // Download the compressed image
                downloadData(compressedBlob, filename, 'image/jpeg');
                
                // Show success message
                showSuccessMessage(`✓ Downloaded: ${filename}`);
                
                // Track download event
                if (typeof dataLayer !== 'undefined') {
                    dataLayer.push({
                        'event': 'tool_download',
                        'toolName': 'Image Compressor',
                        'fileSize': compressedBlob.size
                    });
                }
            }
            
            // Universal download helper
            function downloadData(data, filename, mimeType) {
                try {
                    if (data instanceof HTMLCanvasElement) {
                        data.toBlob(function(blob) {
                            if (blob) {
                                const url = URL.createObjectURL(blob);
                                triggerDownload(url, filename);
                                setTimeout(() => URL.revokeObjectURL(url), 100);
                            }
                        }, mimeType);
                    } else if (data instanceof Blob) {
                        const url = URL.createObjectURL(data);
                        triggerDownload(url, filename);
                        setTimeout(() => URL.revokeObjectURL(url), 100);
                    } else {
                        const blob = new Blob([data], { type: mimeType });
                        const url = URL.createObjectURL(blob);
                        triggerDownload(url, filename);
                        setTimeout(() => URL.revokeObjectURL(url), 100);
                    }
                } catch (error) {
                    console.error('Download failed:', error);
                    alert('Download failed. Please try again.');
                }
            }
            
            function triggerDownload(href, filename) {
                const link = document.createElement('a');
                link.download = filename;
                link.href = href;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // Success message function
            function showSuccessMessage(message) {
                const successMessage = document.createElement('div');
                successMessage.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #4CAF50;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 5px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 1000;
                    font-weight: 500;
                `;
                successMessage.textContent = message;
                document.body.appendChild(successMessage);
                
                setTimeout(() => {
                    if (successMessage.parentNode) {
                        successMessage.parentNode.removeChild(successMessage);
                    }
                }, 3000);
            }
            
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        });
    </script>
</body>
</html>
